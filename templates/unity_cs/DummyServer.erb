/* generated by rpcoder */
using System;
using System.Collections;
using System.Collections.Generic;
using Aiming.IteratorTasks;

namespace <%= get_namespace %>
{
	public class <%= contract_name %>DummyServer : <%= contract_name %>Interface
	{
		public <%= contract_name %>DummyServer(<%= contract_name %>Interface api)
		{
			_api = api;
		}

		private <%= contract_name %>Interface _api;

		public RpcErrorHandler ErrorHandler
		{
			get
			{
				return _api.ErrorHandler;
			}
			set
			{
				_api.ErrorHandler = value;
			}
		}

		public string BaseUrl
		{
			get
			{
				return _api.BaseUrl;
			}
			set
			{
				_api.BaseUrl = value;
			}
		}

		public RpcLogger Logger
		{
			get
			{
				return _api.Logger;
			}
			set
			{
				_api.Logger = value;
			}
		}

		public void AddCommonParameter(string key, string value)
		{
			_api.AddCommonParameter(key, value);
		}

		public string RemoveCommonParameter(string key)
		{
			return _api.RemoveCommonParameter(key);
		}

		<%- rpcs.each do |func| -%>
		<%-
			response = func.name.to_camelcase + "Response"
			successHandler = "Action<" + response + ">"
			request_query = func.params.map{|i| [i.array_or_type, i.name.to_s.to_camelcase(false)].join(' ') }
			params_excluded_error_handler = request_query + [successHandler + ' success']
			params = params_excluded_error_handler + ['RpcErrorHandler error']
		-%>
		public class <%= func.name.to_camelcase %>Request
		{
			<%- func.params.each do |i| -%>
			public <%= i.array_or_type %> <%= i.name.to_s.to_camelcase %>;
			<%- end -%>
			public <%= successHandler %> Success;
			public RpcErrorHandler Error;
		}

		public Func<<%= func.name.to_camelcase %>Request, IEnumerator> <%= func.name.to_camelcase %>Logic { get; set; }

		public IEnumerator <%= func.name.to_camelcase %>(<%= params_excluded_error_handler.join(', ') %>)
		{
			return this.<%= func.name.to_camelcase %>(<%= (func.params.map{|i| i.name.to_s.to_camelcase(false) } + ['success']).join(', ') %>, null, null, null);
		}

		public IEnumerator <%= func.name.to_camelcase %>(<%= params.join(', ') %>, Action throwIfCancelRequested, Action<float> reportProgress)
		{
			if(<%= func.name.to_camelcase %>Logic != null)
			{
				return <%= func.name.to_camelcase %>Logic(new <%= func.name.to_camelcase %>Request(){
				<%- func.params.each do |i| -%>
					<%= i.name.to_s.to_camelcase %> = <%= i.name.to_s.to_camelcase(false) %>,
				<%- end -%>
					Success = success,
					Error = (error != null) ? error : ErrorHandler
					});
			}
			else
			{
				return _api.<%= func.name.to_camelcase %>(
				<%- func.params.each do |i| -%>
					<%= i.name.to_s.to_camelcase(false) %>,
				<%- end -%>
					success,
					(error != null) ? error : ErrorHandler,
					throwIfCancelRequested, reportProgress
					);
			}
		}

		<%- end -%>
	}
}
